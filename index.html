<!DOCTYPE html>
<html>
<head>
<title>Status Check</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

const SUPABASE_URL = "https://vssilapltdpdwulsqtma.supabase.co";
const SUPABASE_KEY = "sb_publishable_tWRkP1Gj73tg7wb3JS9Cvw_8ek2-4EG";

const supabase = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

function showError(msg){
  const el=document.getElementById("error");
  el.style.display="block";
  el.textContent=msg;
}

async function load(){
  try{

    const statusRes =
      await supabase.from("app_status")
      .select("*")
      .eq("id",1)
      .single();

    if(statusRes.error){
      showError(statusRes.error.message);
      return;
    }

    document.getElementById("status").innerText =
      statusRes.data.is_available ? "ðŸ™‚ Any time" : "ðŸ™ Busy";

    const btnRes =
      await supabase.from("buttons")
      .select("*");

    if(btnRes.error){
      showError(btnRes.error.message);
      return;
    }

    const container=document.getElementById("buttons");
    container.innerHTML="";

    btnRes.data.forEach(b=>{
      let btn=document.createElement("button");
      btn.innerText=b.label;
      container.appendChild(btn);
    });

  }catch(e){
    showError(e.message);
  }
}

</script>
</head>

<body onload="load()" style="font-family:sans-serif;text-align:center">

<h1 id="status">Loading...</h1>

<div id="error" style="color:red;font-weight:bold;"></div>

<div id="buttons"></div>

<br><br>

<button onclick="sendRequest()">Send</button>

</body>

</html>
